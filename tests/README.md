# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Instagram API

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è Instagram API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ conftest.py           # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ test_auth.py          # –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test_api.py           # –¢–µ—Å—Ç—ã API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ test_errors.py        # –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ test_integration.py   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ test_utils.py         # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ README.md            # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
pytest
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤
```bash
# –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
pytest tests/test_auth.py

# –¢–µ—Å—Ç—ã API
pytest tests/test_api.py

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/test_integration.py -v
```

### –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
```bash
pytest --cov=app --cov-report=html
```

### –ó–∞–ø—É—Å–∫ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏
```bash
# –¢–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
pytest -m "not slow"

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
pytest -m security

# –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
pytest -m performance
```

## üìä –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤

### üîê –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`test_auth.py`)
- –í–∞–ª–∏–¥–∞—Ü–∏—è API –∫–ª—é—á–µ–π
- –ó–∞—â–∏—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- Rate limiting (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
def test_valid_api_key_success()      # ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π –∫–ª—é—á
def test_invalid_api_key_fails()      # ‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∫–ª—é—á
def test_missing_api_key_fails()      # ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–ª—é—á
```

### üåê –¢–µ—Å—Ç—ã API (`test_api.py`)
- –≠–Ω–¥–ø–æ–∏–Ω—Ç `/login`
- –≠–Ω–¥–ø–æ–∏–Ω—Ç `/send_message`
- –≠–Ω–¥–ø–æ–∏–Ω—Ç `/inbox`
- –≠–Ω–¥–ø–æ–∏–Ω—Ç `/dialogs`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
def test_login_success()              # ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –ª–æ–≥–∏–Ω
def test_send_message_success()       # ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
def test_get_inbox_success()          # ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ inbox
```

### ‚ö†Ô∏è –¢–µ—Å—Ç—ã –æ—à–∏–±–æ–∫ (`test_errors.py`)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
def test_404_for_unknown_endpoint()   # 404 –æ—à–∏–±–∫–∏
def test_malformed_json()             # –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON
def test_sql_injection_attempt()      # –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π
```

### üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (`test_integration.py`)
- –ü–æ–ª–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ —Ü–∏–∫–ª—ã
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π
- CORS –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
def test_complete_login_and_message_flow()  # –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª
def test_session_persistence_after_login()  # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
def test_concurrent_requests_handling()     # –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å
```

## üõ†Ô∏è –ú–æ–∫–∏ –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã (conftest.py)
- `client` - –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç FastAPI
- `auth_headers` - –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å –≤–∞–ª–∏–¥–Ω—ã–º API –∫–ª—é—á–æ–º
- `mock_instagram_client` - –ú–æ–∫ Instagram –∫–ª–∏–µ–Ω—Ç–∞
- `temp_session_file` - –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏

### –£—Ç–∏–ª–∏—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (test_utils.py)
- `MockInstagramClient` - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–æ–∫ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
- `TestDataGenerator` - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `SessionFileManager` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏ —Å–µ—Å—Å–∏–π
- `AssertionHelpers` - –ü–æ–º–æ—â–Ω–∏–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫

## üìà –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–¶–µ–ª—å: **80%+ –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞**

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
pytest --cov=app --cov-report=html

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞
open htmlcov/index.html
```

## üéØ –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

```python
@pytest.mark.unit          # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
@pytest.mark.integration   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
@pytest.mark.api          # –¢–µ—Å—Ç—ã API
@pytest.mark.auth         # –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
@pytest.mark.slow         # –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
@pytest.mark.security     # –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
@pytest.mark.performance  # –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```

## üö® –í–∞–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
pytest -m security -v

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∏–Ω—ä–µ–∫—Ü–∏–∏
pytest tests/test_errors.py::TestSecurityErrors -v
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```bash
# –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
pytest -m performance -v

# –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
pytest tests/test_integration.py::TestPerformanceAndLimits -v
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã –æ—à–∏–±–æ–∫
pytest tests/test_errors.py -v

# –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
pytest tests/test_errors.py::TestDataValidationErrors -v
```

## üîß –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
```bash
pytest -v -s tests/test_api.py::TestLoginEndpoint::test_login_success
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
```bash
pytest -x
```

### –ó–∞–ø—É—Å–∫ —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤
```bash
pytest --lf
```

### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
pytest --profile-svg
```

## üìù –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –®–∞–±–ª–æ–Ω —Ç–µ—Å—Ç–∞
```python
def test_new_feature(client, auth_headers):
    """–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞"""
    # Arrange - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
    data = {"key": "value"}
    
    # Act - –¥–µ–π—Å—Ç–≤–∏–µ
    response = client.post("/endpoint", json=data, headers=auth_headers)
    
    # Assert - –ø—Ä–æ–≤–µ—Ä–∫–∞
    assert response.status_code == 200
    assert response.json() == {"status": "ok"}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–∫–æ–≤
```python
@patch('main.get_client')
def test_with_mock(mock_get_client, client, auth_headers):
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∫–∞
    mock_client = Mock()
    mock_client.some_method.return_value = "expected_result"
    mock_get_client.return_value = mock_client
    
    # –¢–µ—Å—Ç
    response = client.get("/endpoint", headers=auth_headers)
    assert response.status_code == 200
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

- [ ] ‚úÖ –£—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
- [ ] ‚ùå –°—Ü–µ–Ω–∞—Ä–∏–∏ –æ—à–∏–±–æ–∫
- [ ] üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] üìù –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] üß™ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–∫–æ–≤ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞
- [ ] ‚ö° –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- [ ] üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
======================== test session starts ========================
collected 45 items

tests/test_auth.py ........                              [ 17%]
tests/test_api.py ....................                   [ 62%]
tests/test_errors.py .............                       [ 91%]
tests/test_integration.py ....                           [100%]

======================== 45 passed in 2.34s ========================
```